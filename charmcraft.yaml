name: ubuntu-static-reports
type: charm
title: Ubuntu Static Reports charm
summary: Generate Static reports for Ubuntu
description: |
  **Ubuntu Static Reports Operator** is a [charm](https://juju.is/charms-architecture)
  for building and presenting various static reports for Ubuntu. Fetching those
  live from launchpad API or similar sources every time would be too stressful
  and therefore are done on a regular schedule with the reports then being made
  available on the web.

links:
  website:
    - https://charmhub.io/ubuntu-static-reports
  issues:
    - https://github.com/canonical/ubuntu-static-reports-operator/issues
  source:
    - https://github.com/canonical/ubuntu-static-reports-operator

base: ubuntu@24.04
platforms:
  amd64:

parts:
  ubuntu-static-reports-charm:
    source: .
    plugin: uv
    build-packages: [git]
    build-snaps: [astral-uv]
    override-build: |
      craftctl default  # Run the default build steps.
      git describe --always > $CRAFT_PART_INSTALL/version

charm-libs:
  - lib: operator_libs_linux.systemd
    version: "1"
  - lib: traefik_k8s.ingress
    version: "2"

actions:
  refresh:
    description: |
      Force refreshing the content of the static reports.

requires:
  ingress:
    interface: ingress
    limit: 1
    optional: true

config:
  options:
    lpuser_secret_id:
      description: |
        The secret ID for a vault containing the Launchpad oauth token
        under ky lpoauthkey, to be used for services that need
        authenticated users.
      type: secret
